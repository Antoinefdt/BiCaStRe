<!DOCTYPE html>
<html>
<head>
    <title>BiCaStRe - formulaire soumis</title>
    <link rel="icon" type="image/png" href="logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://kit.fontawesome.com/0c87a70838.js"></script>

    <link 
    href="https://db.onlinewebfonts.com/c/6aa06a9a432b8417171f60d8351aa310?family=Torus+Notched"
    rel="stylesheet"
    type="text/css"
    />


    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="end">
        <h1> Bilan Carbone Stage de Recherche</h1>

        <hr><hr>

        <div class="container">
            <div class="logo">
                <img src="logo.png" alt="" height="50">
            </div>
            <div class="onglets">
                <ul>
                    <li><a href="">A propos</a></li>
                    <li><a href="">Simulation</a></li>
                    <li><a href="">Méthodologie</a></li>
                    <li><a href="">Rapports</a></li>
                </ul>
            </div>
        </div>

        <hr><hr>

        <div class="avancee">
            <img src="logo.png" alt="" height="50">
            <img src="logo.png" alt="" height="50">
            <img src="logo.png" alt="" height="50">
            <img src="logo.png" alt="" height="50">
            <img src="logo.png" alt="" height="60">
        </div>

        <h2>Merci pour votre réponse au questionnaire !</h2><br><br>

        <p>Vos résultats seront analysés dans les plus brefs délais. Vous recevrez votre bilan carbone à l'adresse mail institutionnelle que vous avez précisée en début de questionnaire dans un délai de quelques heures.</p><br><br><br><br><br>

        <pre id="resume-reponses"></pre><br><br><br>

        <p>Pour les jours de la semaine travaillés au labo :</p><br><br>
        <p id="resume-reponses-jourshl"></p><br><br><br><br><br>

        <p>Pour les fournitures utilisées :</p><br><br>
        <p id="resume-reponses-fournitures"></p><br><br><br><br><br>

        <p>Pour les consommables utilisés :</p><br><br>
        <p id="resume-reponses-consommables"></p><br><br><br><br><br>

        <div id="fichier_csv"></div><br><br><br>

        <button onclick="Accueil()">Revenir à l'accueil</button><br><br>
        <hr>

        <div class="footer">
        <p>&copy; copyright Antoine FEYDIT - 2023 </p>
        </div>
    </div>

    <script>
        // Récupérer les réponses complètes depuis la session
        const reponsesCompletees = JSON.parse(sessionStorage.getItem('reponsesCompletees'));
        const dplcmt_hl_days = JSON.parse(sessionStorage.getItem('dplcmt_hl_days'));
        const fournitures = JSON.parse(sessionStorage.getItem('fournitures'));
        const consommables = JSON.parse(sessionStorage.getItem('consommables'));
        const indexes = JSON.parse(sessionStorage.getItem('indexes'));

        // Afficher le résumé des réponses dans un élément HTML
        const resumeReponsesElement = document.getElementById('resume-reponses');
        resumeReponsesElement.innerText = JSON.stringify(reponsesCompletees, null, 10);

        const resumeReponsesJourshlElement = document.getElementById('resume-reponses-jourshl');
        resumeReponsesJourshlElement.innerText = JSON.stringify(dplcmt_hl_days, null, 10);
        
        const resumeReponsesFournituresElement = document.getElementById('resume-reponses-fournitures');
        resumeReponsesFournituresElement.innerText = JSON.stringify(fournitures, null, 10);

        const resumeReponsesConsommablesElement = document.getElementById('resume-reponses-consommables');
        resumeReponsesConsommablesElement.innerText = JSON.stringify(consommables, null, 10);



        const DF_Id = [
            reponsesCompletees.email,
            reponsesCompletees.code_grp,
        ];

        const DF_dates = [
            reponsesCompletees.date_beg,
            reponsesCompletees.date_end,
        ];

        const DF_sujet = [
            reponsesCompletees.sub,
            reponsesCompletees.sub_cc,
            reponsesCompletees.sub_cc_why,
        ];

        const DF_lieu = [
            reponsesCompletees.country_dep,
            reponsesCompletees.city_dep,
            reponsesCompletees.country_int,
            reponsesCompletees.city_int,

            reponsesCompletees.mdt_aller,
            reponsesCompletees.Voiture_aller_type,
            reponsesCompletees.Voiture_aller_covoit,

            reponsesCompletees.mdt_retour,
            reponsesCompletees.Voiture_retour_type,
            reponsesCompletees.Voiture_retour_covoit,
        ];

        const DF_pro = [
            reponsesCompletees.dplcmt_pro,
            reponsesCompletees.dplcmt_pro_dist,
            reponsesCompletees.dplcmt_pro_mdt,
            reponsesCompletees.Voiture_pro_type,
            reponsesCompletees.Voiture_pro_covoit,
        ];

        const DF_hl = [
            reponsesCompletees.dplcmt_hl,
            reponsesCompletees.dplcmt_hl_dist,
            reponsesCompletees.dplcmt_hl_mdt,
            reponsesCompletees.Voiture_hl_type,
            reponsesCompletees.Voiture_hl_covoit,
        ];

        const DF_sup = [
            reponsesCompletees.rec_sup,
            reponsesCompletees.rec_sup_time,
            reponsesCompletees.rec_sup_para,
            reponsesCompletees.rec_sup_para_cpu,
        ];

        const DF_four = [
            reponsesCompletees.rec_four,
            reponsesCompletees["Prix_informatique"],
            reponsesCompletees["Prix_audiovisuel"],
            reponsesCompletees["Prix_composants électroniques"],
            reponsesCompletees["Prix_logiciel"],
        ];

        const DF_conso = [
            reponsesCompletees.rec_conso,
            reponsesCompletees["Prix_accessoires"],
            reponsesCompletees["Prix_protection individuelle"],
            reponsesCompletees["Prix_gaz, hélium et azote liquides"],
            reponsesCompletees["Prix_produits chimiques"],
            reponsesCompletees["Prix_plastique et résine"],
            reponsesCompletees["Prix_Animaux de laboratoire (petit)"],
            reponsesCompletees["Prix_Animaux de laboratoire (gros)"],
            reponsesCompletees["Prix_végétal"],
            reponsesCompletees["Prix_pipette"],
            reponsesCompletees["Prix_lame"],
        ];

        const DF_manip = [
            reponsesCompletees.rec_manip,
            reponsesCompletees.rec_manip_energy,
        ];


        const donneesCSV = [DF_Id, DF_dates, DF_lieu, DF_pro, DF_hl, [dplcmt_hl_days], DF_sup, DF_four, [fournitures], DF_conso, [consommables], DF_manip, [indexes]];

        donneesCSV.push([reponsesCompletees.ind_depuis]);
        let depuisIndex = 1;
        while (depuisIndex < indexes[0]+1) {
            let DF_depuis =[];
            DF_depuis.push(reponsesCompletees['ind_depuis_city'+depuisIndex]);
            DF_depuis.push(reponsesCompletees['ind_depuis_nb'+depuisIndex]);
            DF_depuis.push(reponsesCompletees['ind_depuis_mdt_aller'+depuisIndex]);
            DF_depuis.push(reponsesCompletees['Voiture_depuis_aller'+depuisIndex+'_type']);
            DF_depuis.push(reponsesCompletees['ind_depuis_mdt_retour'+depuisIndex]);
            DF_depuis.push(reponsesCompletees['Voiture_depuis_retour'+depuisIndex+'_type']);
            donneesCSV.push(DF_depuis);
            depuisIndex++;
        };

        donneesCSV.push([reponsesCompletees.ind_vers]);
        let versIndex = 1;
        while (versIndex < indexes[1]+1) {
            let DF_vers =[];
            DF_vers.push(reponsesCompletees['ind_vers_city'+versIndex]);
            DF_vers.push(reponsesCompletees['ind_vers_mdt_aller'+versIndex]);
            DF_vers.push(reponsesCompletees['Voiture_vers_aller'+versIndex+'_type']);
            DF_vers.push(reponsesCompletees['Voiture_vers_aller'+versIndex+'_covoit']);
            DF_vers.push(reponsesCompletees['ind_vers_mdt_retour'+versIndex]);
            DF_vers.push(reponsesCompletees['Voiture_vers_retour'+versIndex+'_type']);
            DF_vers.push(reponsesCompletees['Voiture_vers_retour'+versIndex+'_covoit']);
            donneesCSV.push(DF_vers);
            versIndex++;
        };

        donneesCSV.push([reponsesCompletees.ind_loisir]);
        let loisirIndex = 1;
        while (loisirIndex < indexes[2]+1) {
            let DF_loisir =[];
            DF_loisir.push(reponsesCompletees['ind_loisir_country'+loisirIndex]);
            DF_loisir.push(reponsesCompletees['ind_loisir_city'+loisirIndex]);
            DF_loisir.push(reponsesCompletees['ind_loisir_mdt_aller'+loisirIndex]);
            DF_loisir.push(reponsesCompletees['Voiture_loisir_aller'+loisirIndex+'_type']);
            DF_loisir.push(reponsesCompletees['Voiture_loisir_aller'+loisirIndex+'_covoit']);
            DF_loisir.push(reponsesCompletees['ind_loisir_mdt_retour'+loisirIndex]);
            DF_loisir.push(reponsesCompletees['Voiture_loisir_retour'+loisirIndex+'_type']);
            DF_loisir.push(reponsesCompletees['Voiture_loisir_retour'+loisirIndex+'_covoit']);
            donneesCSV.push(DF_loisir);
            loisirIndex++;
        };



        // Convertir les données en format CSV
        const csv = donneesCSV.map(row => row.join(',')).join('\n');

        // Créer un objet Blob à partir du contenu CSV
        const blob = new Blob([csv], { type: 'text/csv' });

        // Créer un URL object pour le Blob
        const url = URL.createObjectURL(blob);

        // Créer un lien pour télécharger le fichier
        const lienTelechargement = document.createElement('a');
        lienTelechargement.href = url;
        lienTelechargement.download = reponsesCompletees.email+'.csv';
        lienTelechargement.textContent = 'Télécharger le fichier CSV';

        const Divfichier_csv = document.getElementById('fichier_csv');

        // Ajouter le lien à la page
        Divfichier_csv.appendChild(lienTelechargement);



        function Accueil() {
            window.location.href = "index.html";
        }
    </script>
</body>